const allCardsContainer=document.getElementsByClassName("cards__main-container")[0];const allLanguageSelectors=document.getElementsByClassName("projects-view__sidebar__option__button");const pageButtons=document.getElementsByClassName("page-selection__button");let pageNumberCurrentEl=document.getElementById("page-selection__number__current");let pageNumberMaxEl=document.getElementById("page-selection__number__max");let allLanguages=[];let activeQuery={languages:[],page:1,customSearch:"",getActiveQueries(){return{languages:this.languages,page:this.page,customSearch:this.customSearch}},reset(){this.languages=[];this.page=1;this.customSearch=""},removeParam(param){if(param==="languages"){this.languages=[]}else if(param==="page"){this.page=1}else if(param==="customSearch"){this.customSearch=""}},removeLanguage(language){this.languages.splice(this.languages.indexOf(language),1)}};let maxPageNumber;function renderProjects(projects){allCardsContainer.innerHTML="";projects.forEach(project=>{const card=document.createElement("div");const cardBody=document.createElement("div");const cardImage=document.createElement("div");const cardTitle=document.createElement("p");const cardText=document.createElement("p");const cardLink=document.createElement("a");card.classList.add("card__container","card__language-"+project.languages_linked);card.id="project-"+project.id;cardImage.classList.add("card__image");cardBody.classList.add("card__body");cardTitle.classList.add("card__title");cardText.classList.add("card__text");cardLink.classList.add("card__link");cardImage.style.backgroundImage="url('/articles_media/direct_images/"+project.img+"')";cardLink.setAttribute("href","/projects/view/"+project.slug);const languageName=allLanguages.find(language=>language.id===project.languages_linked).name;cardTitle.innerText=project.title+" ("+languageName+")";cardText.innerText=project.description;card.classList.add("animate__popIn");cardBody.appendChild(cardTitle);cardBody.appendChild(cardText);card.appendChild(cardImage);card.appendChild(cardBody);card.appendChild(cardLink);allCardsContainer.appendChild(card)})}function selectorProtector(e){if(e.target.id==="option-0"&&e.target.checked){unCheckAllSelectors()}else if(e.target.id!=="option-0"&&e.target.checked){if(document.getElementById("option-0").checked){document.getElementById("option-0").click();allCardsContainer.innerHTML=""}}}function paginationButtonsProtector(currentPage,maxPages){pageNumberCurrentEl.innerText=currentPage;pageNumberMaxEl.innerText=maxPages;for(let i=0;i<pageButtons.length;i++){pageButtons[i].removeAttribute("disabled")}if(currentPage===1||currentPage<0){document.getElementById("page-selection__button__previous").setAttribute("disabled","true")}if(currentPage===maxPages||currentPage>maxPages){document.getElementById("page-selection__button__next").setAttribute("disabled","true")}}function getActiveSelectors(){const activeSelectors=[];for(let i=0;i<allLanguageSelectors.length;i++){if(allLanguageSelectors[i].checked){activeSelectors.push(allLanguageSelectors[i].id.split("-")[1].toString())}}return activeSelectors}function unCheckAllSelectors(){for(let i=0;i<allLanguageSelectors.length;i++){if(allLanguageSelectors[i].checked){allLanguageSelectors[i].click()}}}async function fetchProjects(){let query="/projects/query?";const activeQueries=activeQuery.getActiveQueries();if(activeQueries.languages.length>0){query+="languages="+activeQueries.languages.join(",")+"&"}if(activeQueries.page>1){query+="page="+activeQueries.page+"&"}if(activeQueries.customSearch!==""){query+="search="+activeQueries.customSearch+"&"}query=query.slice(0,-1);let projects=await fetch(query);projects=await projects.json();maxPageNumber=projects.maxPages;allCardsContainer.innerHTML="";renderProjects(projects.data);paginationButtonsProtector(activeQueries.page,projects.maxPages)}async function handleSelectors(){for(let i=0;i<allLanguageSelectors.length;i++){allLanguageSelectors[i].addEventListener("click",async e=>{const targetId=e.target.id;selectorProtector(e);const language=targetId.split("-")[1];if(e.target.checked){activeQuery.languages.push(language)}else{if(targetId==="option-0"){allCardsContainer.innerHTML="";return}if(!getActiveSelectors().length){allCardsContainer.innerHTML="";pageNumberCurrentEl.innerText=1;pageNumberMaxEl.innerText=1;activeQuery.languages=[];return}activeQuery.removeLanguage(language)}if(activeQuery.languages.includes("0")){activeQuery.removeParam("languages")}activeQuery.page=1;await fetchProjects()})}}function pageHandle(){for(let i=0;i<pageButtons.length;i++){pageButtons[i].addEventListener("click",async e=>{if(e.target.getAttribute("disabled")==="true"){return}let pageOperand=1;if(e.target.id==="page-selection__button__previous"){pageOperand=-1}activeQuery.page+=pageOperand;await fetchProjects()})}}function searchInputHandler(){const searchInput=document.getElementById("projects-view__sidebar__search__input");const doneTypingTimer=600;let typingTimer;searchInput.addEventListener("input",async e=>{clearTimeout(typingTimer);typingTimer=setTimeout(async()=>{activeQuery.customSearch=e.target.value;await fetchProjects()},doneTypingTimer)})}const initQuery=async()=>{let firstPageProjects=await fetch("/projects/query");firstPageProjects=await firstPageProjects.json();let allLanguagesEl=document.getElementsByClassName("projects-view__sidebar__option__label");for(let i=0;i<allLanguagesEl.length;i++){let id=allLanguagesEl[i].getAttribute("for").split("-")[1];id=parseInt(id);let name=allLanguagesEl[i].innerText;allLanguages.push({id:id,name:name})}renderProjects(firstPageProjects.data);maxPageNumber=firstPageProjects.maxPages;await handleSelectors();paginationButtonsProtector(parseInt(pageNumberCurrentEl.innerText),firstPageProjects.maxPages);pageHandle();searchInputHandler()};document.addEventListener("DOMContentLoaded",initQuery);