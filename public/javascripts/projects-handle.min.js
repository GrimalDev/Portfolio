const allCardsContainer=document.getElementsByClassName("cards__main-container")[0],allLanguageSelectors=document.getElementsByClassName("projects-view__sidebar__option__button"),pageButtons=document.getElementsByClassName("page-selection__button");let pageNumberCurrentEl=document.getElementById("page-selection__number__current"),pageNumberMaxEl=document.getElementById("page-selection__number__max"),allLanguages=[],activeQuery={languages:[],page:1,customSearch:"",getActiveQueries(){return{languages:this.languages,page:this.page,customSearch:this.customSearch}},reset(){this.languages=[],this.page=1,this.customSearch=""},removeParam(e){"languages"===e?this.languages=[]:"page"===e?this.page=1:"customSearch"===e&&(this.customSearch="")},removeLanguage(e){this.languages.splice(this.languages.indexOf(e),1)}},maxPageNumber;function renderProjects(e){allCardsContainer.innerHTML="",e.forEach(e=>{let t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),r=document.createElement("p"),l=document.createElement("p"),s=document.createElement("a");t.classList.add("card__container","card__language-"+e.languages_linked),t.id="project-"+e.id,n.classList.add("card__image"),a.classList.add("card__body"),r.classList.add("card__title"),l.classList.add("card__text"),s.classList.add("card__link"),n.style.backgroundImage="url('/images/articles/"+e.img+"')",s.setAttribute("href","/projects/view/"+e.slug);let i=allLanguages.find(t=>t.id===e.languages_linked).name;r.innerText=e.title+" ("+i+")",l.innerText=e.description,t.classList.add("animate__popIn"),a.appendChild(r),a.appendChild(l),t.appendChild(n),t.appendChild(a),t.appendChild(s),allCardsContainer.appendChild(t)})}function selectorProtector(e){"option-0"===e.target.id&&e.target.checked?unCheckAllSelectors():"option-0"!==e.target.id&&e.target.checked&&document.getElementById("option-0").checked&&(document.getElementById("option-0").click(),allCardsContainer.innerHTML="")}function paginationButtonsProtector(e,t){pageNumberCurrentEl.innerText=e,pageNumberMaxEl.innerText=t;for(let a=0;a<pageButtons.length;a++)pageButtons[a].removeAttribute("disabled");(1===e||e<0)&&document.getElementById("page-selection__button__previous").setAttribute("disabled","true"),(e===t||e>t)&&document.getElementById("page-selection__button__next").setAttribute("disabled","true")}function getActiveSelectors(){let e=[];for(let t=0;t<allLanguageSelectors.length;t++)allLanguageSelectors[t].checked&&e.push(allLanguageSelectors[t].id.split("-")[1].toString());return e}function unCheckAllSelectors(){for(let e=0;e<allLanguageSelectors.length;e++)allLanguageSelectors[e].checked&&allLanguageSelectors[e].click()}async function fetchProjects(){let e="/projects/query?",t=activeQuery.getActiveQueries();t.languages.length>0&&(e+="languages="+t.languages.join(",")+"&"),t.page>1&&(e+="page="+t.page+"&"),""!==t.customSearch&&(e+="search="+t.customSearch+"&");let a=await fetch(e=e.slice(0,-1));maxPageNumber=(a=await a.json()).maxPages,allCardsContainer.innerHTML="",renderProjects(a.data),paginationButtonsProtector(t.page,a.maxPages)}async function handleSelectors(){for(let e=0;e<allLanguageSelectors.length;e++)allLanguageSelectors[e].addEventListener("click",async e=>{let t=e.target.id;selectorProtector(e);let a=t.split("-")[1];if(e.target.checked)activeQuery.languages.push(a);else{if("option-0"===t){allCardsContainer.innerHTML="";return}if(!getActiveSelectors().length){allCardsContainer.innerHTML="",pageNumberCurrentEl.innerText=1,pageNumberMaxEl.innerText=1,activeQuery.languages=[];return}activeQuery.removeLanguage(a)}activeQuery.languages.includes("0")&&activeQuery.removeParam("languages"),activeQuery.page=1,await fetchProjects()})}function pageHandle(){for(let e=0;e<pageButtons.length;e++)pageButtons[e].addEventListener("click",async e=>{if("true"===e.target.getAttribute("disabled"))return;let t=1;"page-selection__button__previous"===e.target.id&&(t=-1),activeQuery.page+=t,await fetchProjects()})}function searchInputHandler(){let e=document.getElementById("projects-view__sidebar__search__input"),t;e.addEventListener("input",async e=>{clearTimeout(t),t=setTimeout(async()=>{activeQuery.customSearch=e.target.value,await fetchProjects()},600)})}const initQuery=async()=>{let e=await fetch("/projects/query");e=await e.json();let t=document.getElementsByClassName("projects-view__sidebar__option__label");for(let a=0;a<t.length;a++){let n=t[a].getAttribute("for").split("-")[1];n=parseInt(n);let r=t[a].innerText;allLanguages.push({id:n,name:r})}renderProjects(e.data),maxPageNumber=e.maxPages,await handleSelectors(),paginationButtonsProtector(parseInt(pageNumberCurrentEl.innerText),e.maxPages),pageHandle(),searchInputHandler()};document.addEventListener("DOMContentLoaded",initQuery);